!function(){var t=function(){function t(t){h.extend(this,h.extend({omit:!1,name:null,label:null,transform:null,validation:null,type:null},t))}function n(t){return!h.isNumber(t)}function r(t){return t.filter(n).join(".")}function e(t,n,r,e,i,u){return{key:n,value:t,level:e,path:r||[],parent:i,pattern:u}}function i(t,n){function r(t,r){var o=!1,a="leaf";if(h.isObject(t)){var s=this.path.slice(),c=s.push(r),l=e(t,r,s,c,this,null);o=-1!==i.indexOf(t),a="node",o||(u.push(l),i.push(t))}n(t,r,a,this,o)}if(!h.isObject(t)||!h.isFunction(n))throw new Error("First should be an Object, second should be a Function");var i=[],u=[e(t,null,null,1,null,null)];do{var o=u.pop();h.each(o.value,r,o)}while(0!==u.length)}function u(t,n,i){var u=this.path.slice(),o=u.push(n);return i.name=i.name||r(u),e(t,n,u,o,null,i)}function o(n,r){function i(n,r){var e,i,s=this.pattern&&this.pattern[h.isNumber(r)?0:r];return void 0!==s?s instanceof t?(i=this.value[r],s===i&&(i=void 0),e=u.call(this,i,r,s),void o.push(e)):void(h.isObject(s)&&(i=this.value[r],i=h.isObject(i)?i:s,e=u.call(this,i,r,s),a.push({node:e,stage:i}))):void 0}if(!h.isObject(n)||!h.isObject(r))throw new Error("First and Second arguments should be an Object");var o=[],a=[{node:e(n,null,null,1,null,r),stage:r}];do{var s=a.pop();h.each(s.stage,i,s.node)}while(0!==a.length);return o}function a(){var t,n,r,e,i={},u=[];return this===f?(t=this._nodes,e=arguments[0]):(t=arguments[0],e=arguments[1]),e=h.extend({clean:!1,allowNull:!1},e),e.clean&&(r=e.allowNull,t=t.filter(function(t){var n=t.value,e=t.pattern;return h.isFunction(e.omit)?!e.omit(t):h.isBoolean(e.omit)?!e.omit:!h.isEmpty(n,r,e.allowNull)&&h.isExpectedTypeOrNull(n,e.type)})),t.forEach(function(t){var r=t.value,e=t.path;n=i;for(var o=0,a=e.length;a>o;o+=1){var s=e[o],c=e[o+1];void 0===n[s]&&(h.isNumber(c)?(u.push({target:n,targetKey:s}),n[s]=[]):n[s]=void 0!==c?{}:r),n=n[s]}}),u.forEach(function(t){var n=t.target,r=t.targetKey;n[r]=h.compact(n[r])}),i}function s(t,n){if(f.hasOwnProperty(t))throw new Error(h.format("Method [${name}] already exist in chain",{name:t}));if(!h.isFunction(n))throw new Error("Second argument must be a Function");f[t]=n.bind(f)}function c(t,n,r){if(this.hasOwnProperty(t)&&!r)throw new Error(h.format("Module [${name}] already exist",{name:t}));if(!h.isFunction(n))throw new Error("Provider must be a Function");var e=n.call({addMethodToChain:s},h);if(!h.isObject(e))throw new Error("Provider function must return an Object");this[t]=e}var l={},f={},F=/\$\{(\w+)\}/g,d=/\$\{(\d+)\}/g,h={_toString:Object.prototype.toString,_formatObj:function(t,n){return t.replace(F,function(t,r){return n[r]||""})},_formatArgs:function(){var t=arguments[0],n=Array.prototype.slice.call(arguments,1);return t.replace(d,function(t,r){return n[r]||""})},isNaN:function(t){return t!==t},isString:function(t){return"[object String]"===this._toString.call(t)},isFunction:function(t){return!!t&&"[object Function]"===this._toString.call(t)},isObject:function(t){return null!==t&&"object"==typeof t},isNumber:function(t){return"[object Number]"===this._toString.call(t)&&!this.isNaN(t)&&isFinite(t)},isBoolean:function(t){return"boolean"==typeof t},isEmpty:function(t,n,r){var e=null===t;return e&&h.isBoolean(r)?e=!r:e&&h.isBoolean(n)&&(e=!n),e||void 0===t||""===t||this.isNaN(t)||1/0===t},isExpectedTypeOrNull:function(t,n){return null===t||t.constructor===n},first:function(t){return Array.isArray(t)?t[0]:t},identity:function(t){return t},each:function(t,n,r){var e,i,u,o;if(Array.isArray(t))for(e=0,i=t.length;i>e;e+=1)n.call(r,t[e],e);else if(this.isObject(t))for(u=Object.keys(t),e=0,i=u.length;i>e;e+=1)o=u[e],n.call(r,t[o],o)},map:function(t,n,r){var e=[];return this.each(t,function(){e.push(n.apply(this,arguments))},r),e},compact:function(t){if(!Array.isArray(t))return t;var n=[];return this.each(t,function(t){h.isEmpty(t)||n.push(t)}),n},extend:function(t,n){return this.isObject(t)||this.isObject(n)?(this.each(n,function(t,n){this[n]=t},t),t):void 0},groupBy:function(t,n,r){var e={};return r=r||this.identity,t.forEach(function(t,i){var u=n(t,i);t=r(t),e.hasOwnProperty(u)?e[u].push(t):e[u]=[t]}),e},format:function(){var t=arguments,n=t.length,r=t[0],e=t[1];if(2===n&&Array.isArray(e)){var i=e;return i.unshift(r),this._formatArgs.apply(this,i)}return 2===n&&this.isObject(e)?this._formatObj(r,e):n>1?this._formatArgs.apply(this,t):r}};return h.extend(f,{_nodes:null,build:a.bind(f)}),h.extend(l,{matchTraverse:o,traverse:i,defineExtension:c,build:a,vertex:function(){return new t},rule:function(n){if(h.isFunction(n))n={type:n};else if(!h.isObject(n)||!h.isFunction(n.type))throw new Error("First argument must be an Object or Constructor. Type must be defined.");return new t(n)},chain:function(t,n){return f._isRootArray=Array.isArray(t),f._nodes=o(t,n),f}}),l}();t.defineExtension("transform",function(t){function n(t){var n=t.pattern.transform;if(Array.isArray(n))for(var r=0,e=n.length;e>r;r+=1){var i=n[r];t.value=i(t.value,t.key,t.pattern.type)}}function r(){return this._nodes.forEach(n),this}function e(n,r){if(a.hasOwnProperty(n))throw new Error(t.format("Transformer ${0} already exist",n));if(!t.isFunction(r))throw new Error("Second argument is not a Function");a[n]=r}function i(n,r){if(!t.isFunction(n))throw new Error("Argument is not a Function");return r?function(t){return n.bind(null,t)}:n}var u=this,o={},a={};return e("trim",i(function(n){return t.isString(n)?n.trim():n})),e("trimLeft",i(function(n){return t.isString(n)?n.trimLeft():n})),e("trimRight",i(function(n){return t.isString(n)?n.trimRight():n})),e("substring",i(function(n,r){return t.isString(r)?r.substring(n[0],n[1]):r},!0)),e("replace",i(function(n,r){return t.isString(r)?r.replace(n[0],n[1]):r},!0)),e("toUpper",i(function(n){return t.isString(n)?n.toUpperCase():n})),e("toLower",i(function(n){return t.isString(n)?n.toLowerCase():n})),e("toType",i(function(t,n,r){return r(t)})),e("default",i(function(n,r){return t.isEmpty(r)?t.first(n):r},!0)),e("nullIfEmpty",i(function(n){return t.isEmpty(n)?null:n})),this.addMethodToChain("transform",r),t.extend(o,{transformers:a,register:e,build:i,transform:function(t){return u.chain(obj,pattern).transform().build(t)}}),o}),t.defineExtension("validation",function(t){function n(n,r){if(i.hasOwnProperty(n))throw new Error(t.format("Validator ${0} already exist",n));if(!t.isFunction(r))throw new Error("Second argument is not a Function");i[n]=r}function r(n){var r=[],e=this._nodes,u=!!n&&n.detailed,a=t.groupBy(e,function(t){return t.pattern.name},function(t){return t.value});return t.each(e,function(n){var e=n.pattern,s=e.validation;if(t.isObject(s))for(var c,l,f,F,d,h=n.value,m=e.label||e.name,p=Object.keys(s),g=0,y=p.length;y>g;g+=1){if(c=p[g],l=i[c],d=f=s[c],!t.isFunction(l))throw new Error(t.format("Validator ${0} must be defined",c));if(!(t.isEmpty(f)||t.isBoolean(f)&&!f)&&(!Array.isArray(f)&&t.isObject(f)&&(d=f.args||f,F=f.message),l(h,d,a,e)!==!0)){F||(F=o[c]||o.invalid),t.isFunction(F)?F=F(m,h,d,e.type.name):t.isString(F)&&(F=t.format(F,m,h,d,e.type.name)),r.push(u?{ruleName:e.name,key:n.key,value:h,error:F}:F);break}}}),r.length?r:null}var e={},i={},u={email:/^([\w\-\.]+)@((\[[\d]{1,3}\.[\d]{1,3}\.[\d]{1,3}\.)|(([\w\-]+\.)+))([a-zA-Z]{2,4}|\d{1,3})(\]?)$/,digits:/^\d+$/,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},o={required:"${0} is required",invalid:"${0} is invalid",belongsTo:"${0} must be one of (${2})",minLength:"${0} must have length at least ${2}",maxLength:"${0} must have length at most ${2}",eqlLength:"${0} must have length eql ${2}",range:"${0} must be between ${2} and ${3}",email:"${0} must be correct",type:"${0} must have appropriate type",digits:"${0} must contain only digits",url:"${0} must contain correct url of resource"};return n("required",function(n){return!t.isEmpty(n)}),n("type",function(n,r,e,i){return t.isEmpty(n)&&""!==n||t.isExpectedTypeOrNull(n,i.type)}),n("email",function(n){return t.isEmpty(n)||u.email.test(n)}),n("digits",function(n){return t.isEmpty(n)||u.digits.test(n)}),n("url",function(n){return t.isEmpty(n)||u.url.test(n)}),n("minLength",function(n,r){return t.isEmpty(n)||n.length>=r}),n("maxLength",function(n,r){return t.isEmpty(n)||n.length<=r}),n("eqlLength",function(n,r){return t.isEmpty(n)||n.length===r}),n("range",function(n,r){var e=r[0],i=r[1];return t.isEmpty(n)||t.isNumber(n)&&n>e&&i>n}),n("equalTo",function(n,r,e){return n===t.first(e[r])}),n("belongsTo",function(n,r){return t.isEmpty(n)||-1!==r.indexOf(n)}),this.addMethodToChain("validate",r),t.extend(e,{register:n,messages:function(n){if(!t.isObject(n))throw new Error("First argument should be an Object");t.extend(o,n)},validate:function(t,n,r){return this.chain(t,n).validate(r)}}),e}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=t),exports.ISSchemaTools=t):this.ISSchemaTools=t}();