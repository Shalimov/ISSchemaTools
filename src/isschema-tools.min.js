!function(){var t=/\$\{(\w+)\}/g,n=/\$\{(\d+)\}/g,e={_toString:Object.prototype.toString,_formatObj:function(n,e){return n.replace(t,function(t,n){return e[n]||""})},_formatArgs:function(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);return t.replace(n,function(t,n){return e[n]||""})},isNaN:function(t){return t!==t},isString:function(t){return"[object String]"===this._toString.call(t)},isFunction:function(t){return!!t&&"[object Function]"===this._toString.call(t)},isObject:function(t){return null!==t&&"object"==typeof t},isNumber:function(t){return"[object Number]"===this._toString.call(t)&&!this.isNaN(t)&&isFinite(t)},isBoolean:function(t){return"boolean"==typeof t},isEmpty:function(t,n,r){var i=null===t;return i&&e.isBoolean(r)?i=!r:i&&e.isBoolean(n)&&(i=!n),i||void 0===t||""===t||this.isNaN(t)||1/0===t},isEqualArrays:function(t,n){if(t===n)return!0;var e=t.length,r=n.length;if(e!==r)return!1;do if(t[e]!==n[e])return!1;while(e-->=0);return!0},isExpectedTypeOrNull:function(t,n){return null===t||t.constructor===n},first:function(t){return Array.isArray(t)?t[0]:t},identity:function(t){return t},initial:function(t){return Array.isArray(t)?t.slice(0,t.length-1):t},each:function(t,n,e){var r,i,u,o;if(Array.isArray(t))for(r=0,i=t.length;i>r;r+=1)n.call(e,t[r],r);else if(this.isObject(t))for(u=Object.keys(t),r=0,i=u.length;i>r;r+=1)o=u[r],n.call(e,t[o],o)},map:function(t,n,e){var r=[];return this.each(t,function(){r.push(n.apply(this,arguments))},e),r},compact:function(t){if(!Array.isArray(t))return t;var n=[];return this.each(t,function(t){e.isEmpty(t)||n.push(t)}),n},extend:function(t,n){return this.isObject(t)||this.isObject(n)?(this.each(n,function(t,n){this[n]=t},t),t):void 0},groupBy:function(t,n,e){var r={};return e=e||this.identity,t.forEach(function(t,i){var u=n(t,i);t=e(t),r.hasOwnProperty(u)?r[u].push(t):r[u]=[t]}),r},format:function(){var t=arguments,n=t.length,e=t[0],r=t[1];if(2===n&&Array.isArray(r)){var i=r;return i.unshift(e),this._formatArgs.apply(this,i)}return 2===n&&this.isObject(r)?this._formatObj(e,r):n>1?this._formatArgs.apply(this,t):e}},r=function(){function t(t){e.extend(this,e.extend({omit:null,name:null,label:null,transform:null,validation:null,type:null},t))}function n(t){return!e.isNumber(t)}function r(t,n,e,r,i,u){this.key=n,this.value=t,this.level=r,this.path=e||[],this.parent=i,this.pattern=u}function i(t,n){function i(t,i){var a=!1,s="leaf";if(e.isObject(t)){var l=this.path.slice(),c=l.push(i),f=new r(t,i,l,c,this,null);a=-1!==u.indexOf(t),s="node",a||(o.push(f),u.push(t))}n(t,i,s,this,a)}if(!e.isObject(t)||!e.isFunction(n))throw new Error("First should be an Object, second should be a Function");var u=[],o=[new r(t,null,null,1,null,null)];do{var a=o.pop();e.each(a.value,i,a)}while(0!==o.length)}function u(n,e,i){var u=this.path.slice(),o=u.push(e);return i.name=i.name||t.createName(u),new r(n,e,u,o,null,i)}function o(n,i){function o(n,r){var i,o=this.pattern[e.isNumber(r)?0:r];o instanceof t?(i=this.value[r],o===i&&(i=void 0),a.push(u.call(this,i,r,o))):e.isObject(o)&&(i=this.value[r],i=e.isObject(i)?i:o,s.push({node:u.call(this,i,r,o),stage:i}))}if(!e.isObject(n)||!e.isObject(i))throw new Error("First and Second arguments should be an Object");var a=[],s=[{node:new r(n,null,null,1,null,i),stage:i}];do{var l=s.pop();e.each(l.stage,o,l.node)}while(0!==s.length);return a}function a(){var t,n,r,i,u={},o=[];return this===f?(t=this._nodes,i=arguments[0]):(t=arguments[0],i=arguments[1]),i=e.extend({clean:!1,allowNull:!1},i),i.clean&&(r=i.allowNull,t=t.filter(function(t){var n=t.value,i=t.pattern;return e.isFunction(i.omit)?!i.omit(t):e.isBoolean(i.omit)?!i.omit:!e.isEmpty(n,r,i.allowNull)&&e.isExpectedTypeOrNull(n,i.type)})),t.forEach(function(t){var r=t.value,i=t.path;n=u;for(var a=0,s=i.length;s>a;a+=1){var l=i[a],c=i[a+1];void 0===n[l]&&(e.isNumber(c)?(o.push({target:n,targetKey:l}),n[l]=[]):n[l]=void 0!==c?{}:r),n=n[l]}}),o.forEach(function(t){var n=t.target,r=t.targetKey;n[r]=e.compact(n[r])}),u}function s(t,n){if(f.hasOwnProperty(t))throw new Error(e.format("Method [${name}] already exist in chain",{name:t}));if(!e.isFunction(n))throw new Error("Second argument must be a Function");f[t]=n.bind(f)}function l(t,n,r){if(this.hasOwnProperty(t)&&!r)throw new Error(e.format("Module [${name}] already exist",{name:t}));if(!e.isFunction(n))throw new Error("Provider must be a Function");var i=n.call({addMethodToChain:s},e);if(!e.isObject(i))throw new Error("Provider function must return an Object");this[t]=i}var c={},f={};return t.createName=function(t){return t.filter(n).join(".")},e.extend(f,{_nodes:null,build:a.bind(f)}),e.extend(c,{matchTraverse:o,traverse:i,defineExtension:l,build:a,vertex:function(){return new t},rule:function(n){if(e.isFunction(n))n={type:n};else if(!e.isObject(n)||!e.isFunction(n.type))throw new Error("First argument must be an Object or Constructor. Type must be defined.");return new t(n)},chain:function(t,n){return f._isRootArray=Array.isArray(t),f._nodes=o(t,n),f}}),c}();r.defineExtension("transform",function(t){function n(t){var n=t.pattern.transform;if(Array.isArray(n))for(var e=0,r=n.length;r>e;e++)t.value=n[e](t.value,t.key,t.pattern.type)}function e(){return t.each(this._nodes,n),this}function r(n,e){if(o.hasOwnProperty(n))throw new Error(t.format("Transformer ${0} already exist",n));if(!t.isFunction(e))throw new Error("Second argument is not a Function");o[n]=e}function i(n,e){if(!t.isFunction(n))throw new Error("Argument is not a Function");return e?function(t){return n.bind(null,t)}:n}var u=this,o={};return r("trim",i(function(n){return t.isString(n)?n.trim():n})),r("trimLeft",i(function(n){return t.isString(n)?n.trimLeft():n})),r("trimRight",i(function(n){return t.isString(n)?n.trimRight():n})),r("substring",i(function(n,e){return t.isString(e)?e.substring(n[0],n[1]):e},!0)),r("replace",i(function(n,e){return t.isString(e)?e.replace(n[0],n[1]):e},!0)),r("toUpper",i(function(n){return t.isString(n)?n.toUpperCase():n})),r("toLower",i(function(n){return t.isString(n)?n.toLowerCase():n})),r("toType",i(function(t,n,e){return e(t)})),r("default",i(function(n,e){return t.isEmpty(e)?t.first(n):e},!0)),r("nullIfEmpty",i(function(n){return t.isEmpty(n)?null:n})),this.addMethodToChain("transform",e),{transformers:o,register:r,build:i,transform:function(t){return u.chain(obj,pattern).transform().build(t)}}}),r.defineExtension("validation",function(t){function n(t,n){this._nodes=t,this._currentNode=n}function e(n,e){if(i.hasOwnProperty(n))throw new Error(t.format("Validator ${0} already exist",n));if(!t.isFunction(e))throw new Error("Second argument is not a Function");i[n]=e}function r(e){var r=[],u=this._nodes,a=!!e&&e.detailed;return t.each(u,function(e){var s=e.pattern,l=s.validation;if(t.isObject(l))for(var c,f,h,F,d,m=e.value,p=s.label||s.name,g=Object.keys(l),y=0,v=g.length;v>y;y+=1){if(c=g[y],f=i[c],d=h=l[c],!t.isFunction(f))throw new Error(t.format("Validator ${0} must be defined",c));if(!(t.isEmpty(h)||t.isBoolean(h)&&!h)&&(!Array.isArray(h)&&t.isObject(h)&&(d=h.args||h,F=h.message),f(m,d,new n(u,e),s)!==!0)){F||(F=o[c]||o.invalid),t.isFunction(F)?F=F(p,m,d,s.type.name):t.isString(F)&&(F=t.format(F,p,m,d,s.type.name)),r.push(a?{ruleName:s.name,key:e.key,value:m,error:F}:F);break}}}),r.length?r:null}var i={},u={email:/^([\w\-\.]+)@((\[[\d]{1,3}\.[\d]{1,3}\.[\d]{1,3}\.)|(([\w\-]+\.)+))([a-zA-Z]{2,4}|\d{1,3})(\]?)$/,digits:/^\d+$/,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},o={required:"${0} is required",invalid:"${0} is invalid",belongsTo:"${0} must be one of (${2})",minLength:"${0} must have length at least ${2}",maxLength:"${0} must have length at most ${2}",eqlLength:"${0} must have length eql ${2}",range:"${0} must be between ${2} and ${3}",email:"${0} must be correct",type:"${0} must have appropriate type",digits:"${0} must contain only digits",url:"${0} must contain correct url of resource"};return t.extend(n.prototype,{_get:function(n){for(var e=this._nodes,r=t.initial(this._currentNode.path).concat(n.split(".")),i=e.length-1;i>=0;i--)if(t.isEqualArrays(e[i].path,r))return e[i]},_getValueByName:function(t){for(var n=this._nodes,e=[],r=n.length-1;r>=0;r--)n[r].pattern.name===t&&e.push(n[r].value);return e},get:function(t){var n=-1!==t.indexOf("@s");if(n){var e=this._get(t.replace("@s.",""));return e&&e.value}return this._getValueByName(t)}}),e("required",function(n){return!t.isEmpty(n)}),e("type",function(n,e,r,i){return t.isEmpty(n)&&""!==n||t.isExpectedTypeOrNull(n,i.type)}),e("email",function(n){return t.isEmpty(n)||u.email.test(n)}),e("digits",function(n){return t.isEmpty(n)||u.digits.test(n)}),e("url",function(n){return t.isEmpty(n)||u.url.test(n)}),e("minLength",function(n,e){return t.isEmpty(n)||n.length>=e}),e("maxLength",function(n,e){return t.isEmpty(n)||n.length<=e}),e("eqlLength",function(n,e){return t.isEmpty(n)||n.length===e}),e("range",function(n,e){var r=e[0],i=e[1];return t.isEmpty(n)||t.isNumber(n)&&n>r&&i>n}),e("equalTo",function(n,e,r){return n===t.first(r.get(e))}),e("belongsTo",function(n,e){return t.isEmpty(n)||-1!==e.indexOf(n)}),this.addMethodToChain("validate",r),{register:e,messages:function(n){if(!t.isObject(n))throw new Error("First argument should be an Object");t.extend(o,n)},validate:function(t,n,e){return this.chain(t,n).validate(e)}}}),"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=r),exports.ISSchemaTools=r):this.ISSchemaTools=r}();